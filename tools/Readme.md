# 半自动分拆脚本
## 更新说明
20181203 修改了原项目，增加了功能，完善了逻辑

20181203 非windows系统请从https://chromedriver.storage.googleapis.com/index.html?path=2.44/ 下载 driver

20181128 增加了ID设置，在main函数上面几行

## 一、介绍
项目的主要思路很简单，人工找到导航栏的位置，代码自动在导航栏找到a标签，然后按照a标签路径，把结果写入文件。然后合并每个网站的结果，然后根据关键词做过滤。  

### 主要问题
很多时候，一个网站的导航栏对应的都是一个个分站，我们实际要的是进入分站，然后分拆分站的导航栏，本项目也是支持这样的，通过关键字"C"来触发。
## 二、使用说明
修改好了必要的位置（webdriver的路径）之后，可以直接*run split_tool.py* 了
### 2.1 主要使用顺序
1. 所以的配置修改都在源代码main函数前面几行
1. 先将**PROCESS**改成FALSE，表示进入标注模式（默认此模式）
3. 输入url
4. 输入该页面配置（大部分时候直接回车，下面解释配置）
5. 输入导航栏css selector
6. 重复上述过程
7. 完成配置时候修改**PROCESS**为True，进行文件合并过滤
8. 运行源代码得到最后的excel

### 2.2 基本使用
1. 先输入url，url一定是不带www、http等的纯净url，默认情况下脚本自动添加http://www. ，**如果不希望脚本添加，请在url前面添加字母N**，例如xmtfj.gov.cn不需要www：**Nxmtfj.gov.cn**
2. 输入url之后等一下（有时很久，看网络），会提示输入配置，详细配置见下文
2. 配置输入后会提示输入nav的路径，这个时候粘贴nav的css selector
> 导航栏的css selector路径获取，chrome下面审查元素，选中导航栏元素，右键调出菜单，选择Copy->Copy selector，如果你自己会写直接写也是可以的
3. 完成上面两步之后，该导航栏上面的链接将会按照规则写入文件，url的名字会按照层级拼接，例如：*上海交通大学-新闻-院系频道-机械与动力工程学院*
4. 如果该网页有多处需要分拆的类导航栏结构，重复上述过程即可
<center>
<img src="https://note.youdao.com/yws/public/resource/05cbde4498bb988906b20eee74a87c1a/xmlnote/D2E6A377ADE44765AF70F15CE8CC1639/989" width="80%"/>
</center>

<center>
<img src="https://note.youdao.com/yws/public/resource/05cbde4498bb988906b20eee74a87c1a/xmlnote/5F350823C81B4FB997D580BF0506C919/992" width="80%"/>
</center>

### 2.3 配置解释
在完成url输入之后，会提示输入配置string，配置string有**c,tp,tk,title**四种关键字，如果关键字后面有参数，直接接着关键字就可以，例如：title遂宁中文网，关键字之间空格隔开

1. c：标识当前网站为复杂类型网站，该导航栏的url不需要写入文件，而是进过点击进入二级页面
2. tp：title position，表示当前页面的title自动分割之后哪一段最为该网站名字，从1开始，不常用
3. tk：top-k，在解析url的时候最多解析几层，不常用
4. title：直接指示当前网站的title
5. more：类似c，但是是从更多进入一个新的页面，然后对新页面进行分拆，例如：cqdpc.gov.cn，more后面可以接字符串，表示当前页面名字，默认为空
6. ok：当输入ok关键字得时候，当前页面就直接返回，可以配合c，人工确认页面，可以对任何nav使用c，然后等浏览器进入界面后，输入ok确认当前界面正确

下面给出实例：

c tp1 tk20

上面的字符串的意思是当前网站是复杂网站，title是分割之后第一个，选择top20的层级解析


### 2.4 完成导航页面分拆
很多时候，遇到的网站比较变态，比如：[遂宁新闻网](http://www.snxw.com/)这种恶心东西，其导航栏如图所示：

<center>
<img src="https://note.youdao.com/yws/public/resource/05cbde4498bb988906b20eee74a87c1a/xmlnote/20BB75C808C248E09AA53A1E4D0A2E4C/1039" width="80%"/>
</center>
导航栏上面每个item点进去都是一个独立网页，我们需要对那个独立网页进行分拆。   

遇到上述情况，请在配置参数输入**c**，表示该网站为复杂网站。例如：**c**  
在你输入了nav位置之后，脚本不会把当前的nav元素写入文件，而是自动帮你点进去每个item，我们需要做的就是在进入一个item的时候提示输入nav，我们输入子网站的导航栏css
selector就行了，输入之后，系统会自动保存每个子网站的分拆结果，最后汇总到总站去。

## 三、代码说明
代码主要分为两部分：
1. 页面结果获取部分
2. 结果汇总过滤部分

控制两部分的主要变量是**PROCESS**，在main函数前面

整体设计是每个网站均写入自己的csv文件，然后最后通过合并操作把所有的结果汇总，最后再进行过滤。所有数据操作使用pandas，主要是pandas操作数据方便快捷。
